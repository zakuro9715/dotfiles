source "$HOME/.zsh/prompt.zsh"
source "$HOME/.zsh/completion.zsh"

export EDITOR=vim
export PATH="$HOME/.rbenv/bin:$PATH"

export NVM_DIR="/home/zakuro9715/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm

eval "$(rbenv init -)"
eval "$(direnv hook zsh)"

orphans() {
  if [[ ! -n $(pacman -Qdt) ]]; then
    echo "No orphans to remove."
  else
    sudo pacman -Rns $(pacman -Qdtq)
  fi
}


precmd () { 
  vcs_info 
  prompt
}


# cd

chpwd() {
  check_pyvenv
}

check_pyvenv() {
  if [[ -n "$VIRTUAL_ENV" ]]; then
    case $(pwd) in
      $VIRTUAL_ENV* ) ;; # In venv
      *             ) deactivate ;;
    esac
  elif [[ -r 'bin/activate' ]]; then # Can read bin/activate and venv hasn't activated
    source 'bin/activate'
  fi
}

# enter

do_enter() {
  if [ -n "$BUFFER" ]; then
    zle accept-line
    return 0
  fi  
  echo
  ls
  zle reset-prompt
}
zle -N do_enter
bindkey '^m' do_enter
